#Step1
echo "<*****>Installing Git in RHEL 8"
dnf install -y git
#Step2
sudo mkdir /home/cammanager/documents
sudo cd /home/cammanager/documents
#¡ERROR!
sudo git clone --recurse-submodules -j8 https://AlejandroParqueExplora@bitbucket.org/parqueexploradevelopers/vagrant_centos_node_nginx.git
curl -o output.zip https://github.com/AlejoRondon/vagrant_centos_node_nginx/archive/master.zip

#Step3
echo "<------>Installing NGINX"
sudo dnf -y update
sudo dnf install -y nginx tmux tar
# Start the Nginx service:
echo "<------>Starting NGINX"
sudo systemctl start nginx
echo "<------>Enablig NGINX"
sudo systemctl enable nginx
echo "<------>Checking NGINX response"
curl http://localhost/
echo "<------>Creating NGINX directories"
sudo mkdir -p /etc/nginx/{sites-available,sites-enabled}
sudo mkdir -p /var/www

#Step4
echo "<¬¬¬¬¬>STARTING UP FIREWALLD<¬¬¬¬¬>"
echo "https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-8-es"
systemctl enable firewalld
systemctl start firewalld
firewall-cmd --zone=public --permanent --add-service=http
firewall-cmd --zone=public --permanent --add-service=https
 
firewall-cmd --zone=public --permanent --add-port=80/tcp
firewall-cmd --zone=public --permanent --add-port=20-22/tcp
firewall-cmd --zone=public --permanent --add-port=3000-3100/tcp
firewall-cmd --zone=public --permanent --add-port=5000-5100/tcp
firewall-cmd --zone=public --permanent --add-port=9000-9100/tcp
firewall-cmd --zone=public --permanent --add-port=30000-31000/tcp
firewall-cmd --permanent --zone=public --add-service=postgresql

echo "<¬¬¬¬¬>FIREWALLD STATE>"
firewall-cmd --state
echo "<¬¬¬¬¬>FIREWALLD RELOAD"
firewall-cmd --reload
echo "<¬¬¬¬¬>FIREWALLD OPEN PORTS"
firewall-cmd --zone=public --list-ports --permanent
echo "<¬¬¬¬¬>FIREWALLD SERVICES"
firewall-cmd --zone=public --list-services --permanent
echo "<¬¬¬¬¬>FIREWALLD DEFAULT ZONE>"
firewall-cmd --get-default-zone
echo "<¬¬¬¬¬>FIREWALLD ACTIVE ZONE>"
firewall-cmd --get-active-zones
echo "<¬¬¬¬¬>FIREWALLD LIST>"
firewall-cmd --list-all

#Step5
echo "<¬¬¬¬¬>INSTALLING NANO EDITOR<¬¬¬¬¬>"
sudo yum install -y nano
echo "<¬¬¬¬¬>INSTALLIN WGET PACKAGE MANAGER<¬¬¬¬¬>"
sudo yum install -y wget

#Step6
#PHP repo configuration
#https://linuxconfig.org/redhat-8-epel-install-guide
sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-8.rpm -y
sudo dnf install epel-release -y
sudo rpm -ql epel-release
sudo dnf repolist -v
sudo dnf repository-packages epel list

#PHP Installation
sudo dnf module list php -y
sudo dnf module enable php:remi-7.4 -y
sudo dnf install -y php php-cli php-common
sudo dnf install -y php-mysql
sudo yum install -y php-pgsql php-pdo_pgsql
php -v
sudo systemctl start php-fpm
sudo systemctl enable php-fpm
sudo systemctl restart httpd
#Verifing php-fpm is running
sudo systemctl status php-fpm

echo "<------>Updating php configuration files"
cp /home/cammanager/documents/vagrant_centos_node_nginx/configuration_files/etc/php-fpm.d/www.conf /etc/php-fpm.d/www.conf
sudo systemctl restart php-fpm






#https://code.visualstudio.com/docs/remote/ssh
#https://github.com/microsoft/vscode-remote-release/issues/38
#echo $SSH_CLIENT | awk '{ print $1}'
#pinky